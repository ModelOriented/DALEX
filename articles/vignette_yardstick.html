<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use DALEX with the yardstick package? • DALEX</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use DALEX with the yardstick package?">
<meta property="og:description" content="DALEX">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">DALEX</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/" class="external-link">MI^2 DataLab</a> </span>
          <span class="version version-default">2.4.2</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multilabel_classification.html">How to use multilabel classification and DALEX?</a>
    </li>
    <li>
      <a href="../articles/vignette_titanic.html">Survival on the RMS Titanic</a>
    </li>
    <li>
      <a href="../articles/vignette_yardstick.html">How to use DALEX with the yardstick package?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/DALEX/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette_yardstick_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use DALEX with the yardstick package?</h1>
                        <h4 data-toc-skip class="author">Przemyslaw Biecek</h4>
            
            <h4 data-toc-skip class="date">2022-05-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/DALEX/blob/HEAD/vignettes/vignette_yardstick.Rmd" class="external-link"><code>vignettes/vignette_yardstick.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_yardstick.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p><a href="https://yardstick.tidymodels.org/reference/index.html" class="external-link">yardstick</a> is a package that offers many measures for evaluating model performance. It is based on the <code>tidymodels</code>/<code>tidyverse</code> philosophy, the performance is calculated by functions working on the data.frame with the results of the model.</p>
<p><a href="https://dalex.drwhy.ai/" class="external-link">DALEX</a> uses model performance measures to assess the importance of variables (in the model_parts function). These are typically calculated based on loss functions (functions with prefix <code>loss</code>) that are working on two vectors - the score from the model and the true target variable.</p>
<p>Although these packages have a slightly different philosophy of operation, you can use the measures available in yardstick when working with <code>DALEX.</code> Below is information on how to use the <code>loss_yardstick</code> function to do this.</p>
</div>
<div class="section level2">
<h2 id="prepare-a-classification-model">Prepare a classification model<a class="anchor" aria-label="anchor" href="#prepare-a-classification-model"></a>
</h2>
<p>The <code>yardstick</code> package supports both classification models and regression models. We will start our example with a classification model for the titanic data - the probability of surviving this disaster.</p>
<p>The following instruction trains a classification model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://modeloriented.github.io/DALEX/" class="external-link">"DALEX"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/tidymodels/yardstick" class="external-link">"yardstick"</a></span><span class="op">)</span>
<span class="va">titanic_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">survived</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">titanic_imputed</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="class-probability-metrics">Class Probability Metrics<a class="anchor" aria-label="anchor" href="#class-probability-metrics"></a>
</h3>
<p>The Class Probability Metrics in the <code>yardstick</code> package assume that the true value is a <code>factor</code> and the model returns a numerical score. So let’s prepare an <code>explainer</code> that has <code>factor</code> as <code>y</code> and the <code>predict_function</code> returns the probability of the target class (default behaviour).</p>
<p><strong>NOTE</strong>: Performance measures will be calculated on data supplied in the explainer. Put here the test data!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explainer_glm</span> <span class="op">&lt;-</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="../reference/explain.html">explain</a></span><span class="op">(</span><span class="va">titanic_glm</span>,
                        data <span class="op">=</span> <span class="va">titanic_imputed</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>,
                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">titanic_imputed</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To make functions from the <code>yardstick</code> compatible with <code>DALEX</code> we must use the <code>loss_yardstick</code> adapter. In the example below we use the <code>roc_auc</code> function (area under the receiver operator curve). The <code>yardstick::</code> prefix is not necessary, but we put it here to show explicitly where the functions you use are located.</p>
<p><strong>NOTE</strong>: we set <code>yardstick.event_first = FALSE</code> as the model predicts probability of <code>survived = 1</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>yardstick.event_first <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">glm_auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                  loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">glm_auc</span></code></pre></div>
<pre><code><span class="co">#&gt;       variable mean_dropout_loss label</span>
<span class="co">#&gt; 1 _full_model_         0.8112957    lm</span>
<span class="co">#&gt; 2       gender         0.6350986    lm</span>
<span class="co">#&gt; 3        class         0.7156878    lm</span>
<span class="co">#&gt; 4          age         0.7812970    lm</span>
<span class="co">#&gt; 5        sibsp         0.8019703    lm</span>
<span class="co">#&gt; 6     embarked         0.8055721    lm</span>
<span class="co">#&gt; 7         fare         0.8112059    lm</span>
<span class="co">#&gt; 8        parch         0.8113836    lm</span>
<span class="co">#&gt; 9   _baseline_         0.4970529    lm</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_auc</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>In a similar way, we can use the <code>pr_auc</code> function (area under the precision recall curve).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm_prauc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                  loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/pr_auc.html" class="external-link">pr_auc</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">glm_prauc</span></code></pre></div>
<pre><code><span class="co">#&gt;       variable mean_dropout_loss label</span>
<span class="co">#&gt; 1 _full_model_         0.7453253    lm</span>
<span class="co">#&gt; 2       gender         0.4241547    lm</span>
<span class="co">#&gt; 3        class         0.5920422    lm</span>
<span class="co">#&gt; 4          age         0.7165849    lm</span>
<span class="co">#&gt; 5        sibsp         0.7258662    lm</span>
<span class="co">#&gt; 6     embarked         0.7336104    lm</span>
<span class="co">#&gt; 7         fare         0.7452077    lm</span>
<span class="co">#&gt; 8        parch         0.7453817    lm</span>
<span class="co">#&gt; 9   _baseline_         0.3105478    lm</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_prauc</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="classification-metrics">Classification Metrics<a class="anchor" aria-label="anchor" href="#classification-metrics"></a>
</h3>
<p>The Classification Metrics in the <code>yardstick</code> package assume that the true value is a <code>factor</code> and the model returns a <code>factor</code> variable.</p>
<p>This is different behavior than for most explanations in DALEX, because when explaining predictions we typically operate on class membership probabilities. If we want to use Classification Metrics we need to provide a predict function that returns classes instead of probabilities.</p>
<p>So let’s prepare an <code>explainer</code> that has <code>factor</code> as <code>y</code> and the <code>predict_function</code> returns classes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explainer_glm</span> <span class="op">&lt;-</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="../reference/explain.html">explain</a></span><span class="op">(</span><span class="va">titanic_glm</span>,
                        data <span class="op">=</span> <span class="va">titanic_imputed</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>,
                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">titanic_imputed</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span>,
                        predict_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>,<span class="va">x</span><span class="op">)</span> <span class="op">{</span>
                              <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">x</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span>, 
                                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>
                        <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Again, let’s use the <code>loss_yardstick</code> adapter. In the example below we use the <code>accuracy</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm_accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                    loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">glm_accuracy</span></code></pre></div>
<pre><code><span class="co">#&gt;       variable mean_dropout_loss label</span>
<span class="co">#&gt; 1 _full_model_            0.8009    lm</span>
<span class="co">#&gt; 2       gender            0.6518    lm</span>
<span class="co">#&gt; 3        class            0.7395    lm</span>
<span class="co">#&gt; 4          age            0.7864    lm</span>
<span class="co">#&gt; 5        sibsp            0.7956    lm</span>
<span class="co">#&gt; 6     embarked            0.7996    lm</span>
<span class="co">#&gt; 7        parch            0.8006    lm</span>
<span class="co">#&gt; 8         fare            0.8011    lm</span>
<span class="co">#&gt; 9   _baseline_            0.5963    lm</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_accuracy</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>In a similar way, we can use the <code>bal_accuracy</code> function (balanced accuracy).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm_bal_accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                    loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/bal_accuracy.html" class="external-link">bal_accuracy</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">glm_bal_accuracy</span></code></pre></div>
<pre><code><span class="co">#&gt;       variable mean_dropout_loss label</span>
<span class="co">#&gt; 1 _full_model_         0.7434741    lm</span>
<span class="co">#&gt; 2       gender         0.5585266    lm</span>
<span class="co">#&gt; 3        class         0.6777309    lm</span>
<span class="co">#&gt; 4          age         0.7286767    lm</span>
<span class="co">#&gt; 5     embarked         0.7369737    lm</span>
<span class="co">#&gt; 6        sibsp         0.7396725    lm</span>
<span class="co">#&gt; 7         fare         0.7429791    lm</span>
<span class="co">#&gt; 8        parch         0.7430213    lm</span>
<span class="co">#&gt; 9   _baseline_         0.5018742    lm</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_bal_accuracy</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="the-lower-the-better">The lower the better?<a class="anchor" aria-label="anchor" href="#the-lower-the-better"></a>
</h3>
<p>For the loss function, the smaller the values the better the model. Therefore, the importance of variables is often calculated as <code>loss(perturbed) - loss(original)</code>.</p>
<p>But many model performance functions have the opposite characteristic, the higher they are the better (e.g. <code>AUC</code>, <code>accuracy</code>, etc). To maintain a consistent analysis pipeline it is convenient to invert such functions, e.g. by converting to <code>1- AUC</code> or <code>1 - accuracy</code>.</p>
<p>To do it, just add the <code>reverse = TRUE</code> argument.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm_1accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, 
                    loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="va">accuracy</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">glm_1accuracy</span></code></pre></div>
<pre><code><span class="co">#&gt;       variable mean_dropout_loss label</span>
<span class="co">#&gt; 1 _full_model_            0.1963    lm</span>
<span class="co">#&gt; 2         fare            0.1959    lm</span>
<span class="co">#&gt; 3        parch            0.1967    lm</span>
<span class="co">#&gt; 4     embarked            0.1977    lm</span>
<span class="co">#&gt; 5        sibsp            0.2029    lm</span>
<span class="co">#&gt; 6          age            0.2130    lm</span>
<span class="co">#&gt; 7        class            0.2519    lm</span>
<span class="co">#&gt; 8       gender            0.3623    lm</span>
<span class="co">#&gt; 9   _baseline_            0.4177    lm</span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_1accuracy</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="calculate-performance-on-whole-dataset">Calculate performance on whole dataset<a class="anchor" aria-label="anchor" href="#calculate-performance-on-whole-dataset"></a>
</h3>
<p>By default the performance is calculated on <code>N = 1000</code> randomly selected observations (to speed up the calculations). Set <code>N = NULL</code> to use the whole dataset.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm_1accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_glm</span>, 
                    loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="va">accuracy</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                    N <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">glm_1accuracy</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="prepare-a-regression-model">Prepare a regression model<a class="anchor" aria-label="anchor" href="#prepare-a-regression-model"></a>
</h2>
<p>The following instruction trains a regression model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/imbs-hl/ranger" class="external-link">"ranger"</a></span><span class="op">)</span>
<span class="va">apartments_ranger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="va">m2.price</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">apartments</span>, num.trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="regression-metrics">Regression Metrics<a class="anchor" aria-label="anchor" href="#regression-metrics"></a>
</h3>
<p>The Regression Metrics in the <code>yardstick</code> package assume that the true value is a <code>numeric</code> variable and the model returns a <code>numeric</code> score.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explainer_ranger</span>  <span class="op">&lt;-</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="../reference/explain.html">explain</a></span><span class="op">(</span><span class="va">apartments_ranger</span>, data <span class="op">=</span> <span class="va">apartments</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                             y <span class="op">=</span> <span class="va">apartments</span><span class="op">$</span><span class="va">m2.price</span>, label <span class="op">=</span> <span class="st">"Ranger Apartments"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; Preparation of a new explainer is initiated</span>
<span class="co">#&gt;   -&gt; model label       :  Ranger Apartments </span>
<span class="co">#&gt;   -&gt; data              :  1000  rows  5  cols </span>
<span class="co">#&gt;   -&gt; target variable   :  1000  values </span>
<span class="co">#&gt;   -&gt; predict function  :  yhat.ranger  will be used (  default  )</span>
<span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span>
<span class="co">#&gt;   -&gt; model_info        :  package ranger , ver. 0.13.1 , task regression (  default  ) </span>
<span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  1881.619 , mean =  3488.811 , max =  6190.515  </span>
<span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span>
<span class="co">#&gt;   -&gt; residuals         :  numerical, min =  -521.673 , mean =  -1.79163 , max =  621.4577  </span>
<span class="co">#&gt;   A new explainer has been created!</span></code></pre>
<p>To make functions from the <code>yardstick</code> compatible with <code>DALEX</code> we must use the <code>loss_yardstick</code> adapter. In the example below we use the <code>rmse</code> function (root mean squared error).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ranger_rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_ranger</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                      loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span>
<span class="va">ranger_rmse</span></code></pre></div>
<pre><code><span class="co">#&gt;            variable mean_dropout_loss             label</span>
<span class="co">#&gt; 1      _full_model_          156.3499 Ranger Apartments</span>
<span class="co">#&gt; 2          no.rooms          276.5140 Ranger Apartments</span>
<span class="co">#&gt; 3 construction.year          390.1294 Ranger Apartments</span>
<span class="co">#&gt; 4             floor          433.1465 Ranger Apartments</span>
<span class="co">#&gt; 5           surface          565.5482 Ranger Apartments</span>
<span class="co">#&gt; 6          district          766.4657 Ranger Apartments</span>
<span class="co">#&gt; 7        _baseline_         1205.1072 Ranger Apartments</span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranger_rmse</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>And one more example for <code>rsq</code> function (R squared).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ranger_rsq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_ranger</span>, type <span class="op">=</span> <span class="st">"raw"</span>,
                      loss_function <span class="op">=</span> <span class="fu"><a href="../reference/loss_yardstick.html">loss_yardstick</a></span><span class="op">(</span><span class="va">rsq</span><span class="op">)</span><span class="op">)</span>
<span class="va">ranger_rsq</span></code></pre></div>
<pre><code><span class="co">#&gt;            variable mean_dropout_loss             label</span>
<span class="co">#&gt; 1      _full_model_       0.981520361 Ranger Apartments</span>
<span class="co">#&gt; 2          district       0.333220715 Ranger Apartments</span>
<span class="co">#&gt; 3           surface       0.602216180 Ranger Apartments</span>
<span class="co">#&gt; 4             floor       0.769761085 Ranger Apartments</span>
<span class="co">#&gt; 5 construction.year       0.819190001 Ranger Apartments</span>
<span class="co">#&gt; 6          no.rooms       0.947619284 Ranger Apartments</span>
<span class="co">#&gt; 7        _baseline_       0.001129855 Ranger Apartments</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranger_rsq</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_yardstick_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>I hope that using the <code>yardstick</code> package at <code>DALEX</code> will now be easy and enjoyable. If you would like to share your experience with this package, please create an issue at <a href="https://github.com/ModelOriented/DALEX/issues" class="external-link uri">https://github.com/ModelOriented/DALEX/issues</a>.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; R version 4.2.0 (2022-04-22)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Big Sur/Monterey 10.16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] ranger_0.13.1   yardstick_0.0.9 DALEX_2.4.2    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] tidyselect_1.1.2  xfun_0.31         bslib_0.3.1       purrr_0.3.4      </span>
<span class="co">#&gt;  [5] lattice_0.20-45   colorspace_2.0-3  vctrs_0.4.1       generics_0.1.2   </span>
<span class="co">#&gt;  [9] htmltools_0.5.2   yaml_2.3.5        utf8_1.2.2        rlang_1.0.2      </span>
<span class="co">#&gt; [13] pkgdown_2.0.3     jquerylib_0.1.4   pillar_1.7.0      glue_1.6.2       </span>
<span class="co">#&gt; [17] lifecycle_1.0.1   plyr_1.8.7        stringr_1.4.0     munsell_0.5.0    </span>
<span class="co">#&gt; [21] gtable_0.3.0      ragg_1.2.2        memoise_2.0.1     evaluate_0.15    </span>
<span class="co">#&gt; [25] labeling_0.4.2    knitr_1.39        fastmap_1.1.0     fansi_1.0.3      </span>
<span class="co">#&gt; [29] highr_0.9         Rcpp_1.0.8.3      scales_1.2.0      cachem_1.0.6     </span>
<span class="co">#&gt; [33] desc_1.4.1        jsonlite_1.8.0    ingredients_2.2.0 farver_2.1.0     </span>
<span class="co">#&gt; [37] systemfonts_1.0.4 fs_1.5.2          textshaping_0.3.6 ggplot2_3.3.6    </span>
<span class="co">#&gt; [41] digest_0.6.29     stringi_1.7.6     dplyr_1.0.9       grid_4.2.0       </span>
<span class="co">#&gt; [45] rprojroot_2.0.3   cli_3.3.0         tools_4.2.0       magrittr_2.0.3   </span>
<span class="co">#&gt; [49] sass_0.4.1        tibble_3.1.7      crayon_1.5.1      pkgconfig_2.0.3  </span>
<span class="co">#&gt; [53] Matrix_1.4-1      ellipsis_0.3.2    pROC_1.18.0       rmarkdown_2.14   </span>
<span class="co">#&gt; [57] R6_2.5.1          compiler_4.2.0</span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
